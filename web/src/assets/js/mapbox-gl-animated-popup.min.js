/*!
 * Mapbox GL JS Animated Popup v0.2.1
 * https://nagix.github.io/mapbox-gl-animated-popup
 * (c) 2020-2021 Akihiko Kusanagi
 * Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mapbox-gl")):"function"==typeof define&&define.amd?define(["mapbox-gl"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).AnimatedPopup=t(e.mapboxgl)}(this,(function(e){"use strict";const t={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e)),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic(e){let t=1.70158,n=0;return 0===e?0:1===e?1:(n||(n=.3),t=n/(2*Math.PI)*Math.asin(1),-1*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n))},easeOutElastic(e){let t=1.70158,n=0;return 0===e?0:1===e?1:(n||(n=.3),t=n/(2*Math.PI)*Math.asin(1),1*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/n)+1)},easeInOutElastic(e){let t=1.70158,n=0;return 0===e?0:2==(e/=.5)?1:(n||(n=.45),t=n/(2*Math.PI)*Math.asin(1),e<1?1*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)*-.5:1*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/n)*.5+1)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-t.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?.5*t.easeInBounce(2*e):.5*t.easeOutBounce(2*e-1)+.5};function n(e,n,a,s,i){let o;const r=performance.now(),u=()=>{if(o)return;const c=performance.now()-r,p=0===a?1:Math.min(c/a,1),h=t[n](p);e.transform=`scale(${s?1-h:h})`,p<1?requestAnimationFrame(u):i&&i()};return u(),()=>{o=!0}}function a(e,...t){for(const n of t)for(const t in n)"object"==typeof n[t]?(e[t]||(e[t]={}),a(e[t],n[t])):e[t]=n[t];return e}function s(e){for(const t of e.values()){const e=t.match(/mapboxgl-popup-anchor-(.+)/);if(e)return e[1].replace("-"," ")}}const i={openingAnimation:{duration:1e3,easing:"easeOutElastic"},closingAnimation:{duration:300,easing:"easeInBack"}};return class extends e.Popup{constructor(e){super(e),a(this.options,a({},i,e))}addTo(...e){return this._map&&this._remove(),super.addTo(...e)}_remove(){const e=this._wrapperContainer;this._cancelAnimation&&this._cancelAnimation(),e&&e.parentNode&&(e.parentNode.removeChild(e),delete this._wrapperContainer),super.remove()}remove(){if(this._wrapperContainer){const{easing:e,duration:t}=this.options.closingAnimation;this._cancelAnimation&&this._cancelAnimation(),this._cancelAnimation=n(this._container.style,e,t,!0,(()=>{this._remove()}))}else super.remove();return this}_update(...t){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;const a=this._map._requestDomTask;let i,o=this._wrapperContainer,r=this._container;Object.defineProperty(this,"_container",{configurable:!0,get:()=>r,set:e=>{const{easing:t,duration:a}=this.options.openingAnimation;o=this._wrapperContainer=document.createElement("div"),o.className="mapboxgl-popup-wrapper",o.style.position="absolute",o.style.willChange="transform",o.style.pointerEvents="none",r=e,r.style.position="relative",this._map.getContainer().appendChild(o),o.appendChild(r),this._cancelAnimation=n(r.style,t,a)}}),e.version>="2.3"?this._map._requestDomTask=e=>{a.call(this._map,(()=>{i=r?r.style.transform:"scale(0)",e(),o.style.transform=r.style.transform,r.style.transform=i,r.style.transformOrigin=s(r.classList)}))}:i=r?r.style.transform:"scale(0)",super._update(...t),delete this._container,this._container=r,e.version>="2.3"?this._map._requestDomTask=a:(o.style.transform=r.style.transform,r.style.transform=i,r.style.transformOrigin=s(r.classList))}}}));
//# sourceMappingURL=mapbox-gl-animated-popup.min.js.map
